<!DOCTYPE html>
<html lang="en">
   <head>
     <title>TsantaBot | Actifs</title>
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
     <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
     <link rel="stylesheet" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="styles.css">
   </head>
   <body>
      <button class="btn btn-primary btn-ml shadow" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasTop" aria-controls="offcanvasTop" style="position: fixed"><i class="fa-solid fa-list"></i></button>
      <div class="offcanvas offcanvas-top shadow" tabindex="-1" id="offcanvasTop" aria-labelledby="offcanvasTopLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasTopLabel">TsantaBot</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <div class="colX text-center" style="padding:10px">
            <a href="/guide" class="btn btn-dark">Guide</a>
            <a href="/" class="btn btn-primary">TsantaBot</a>
            <a href="https://ianatra.a0001.net" class="btn btn-danger">Cours </a>
            </div><hr>
             <div>
               <p class="badge bg-info rounded-pill" style="font-size: 16px">Conseil:</p>
               <ol>
               <li>Comptefb vaovao ampiasaina</li>
               <li>Verifieo tsara ny adresse Mail ny compte fb mba ho mora récupérena rehefa Bloqué tampoka</li>
               <li>Mety ho bloqué tampoka ny fb anao rehefa mifanoitra amin'ny Termes et Conditions générales. Azo récupérena tsara raha confirmé ny adresse Mail.</li>
               <li>Olona 1 = Chatbot iray, raha manamboatra Chatbot mihoatran'ny 2 ianao dia restreint avy hatrany ihany koa ny compte fb Chatbot. Noho izany dia compte 1 ihany atao mba tsy ho restreint foana izay compte ho sokafanao amin'ny findaynao.</li>
               <li>Raha hidirana ilay Compte fb misy Chatbot efa mandeha dia mety ho bloqué avy hatrany ilay Fb. Noho izany dia tsy tokony hidirana ilay Chatbot fa azonao atao kosa ny mampiditra azy ao anaty Chat groupe messenger...</li>
               <li>Azo ampiasaina ireo cmd gratuit, misy pub sy limite  de temps. azo fidiana ihany koa izay cmd tena tinao sy ilainao.</li>
               <li>Afaka manampy commande Pro ihany koa ianao eo @(Choix commandes) raha te hampivoatra sy hisehatra amin'ny  mode Professionnel, sans pub.</li>
               <li>Rehefa tiana hoesorina na tsy hampiasa Chatbot amin'ny compte dia miditra ao amin'ny fbstate (jereo Guide) dia avieo ilay Déconnecté no tsindrina.</li>
               <li>Raha mila fanampiana na hanao zavatra personnalisé dia afaka mifandray fb. Jereo amin'ny farany ambany no misy ny lien fb.</li>
               <li>Mampiasaha finaritra sy amin'ny  tsara tompoko !<br><br> Mbola hanampy zavatra vaovao maro be eto izahay afaka fotoana foy. Stay tunned.</li>
               
               </ol>
              
             
          </div>
        </div>
      </div>
      <div class="container">
         <div class="row">
            <h1 class="col text-start text-light" style="margin-left: 12px; font-size: 20px;">Chatbot en ligne  <button style="font-size : 11px; text-decoration:none" class="btn" data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom" aria-controls="offcanvasBottom">:</button>
</h1>
         </div>
         <div class="row" id="user_online"></div>
      </div>


      
<div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasBottom" aria-labelledby="offcanvasBottomLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasBottomLabel">Déconnexion</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body small">
    <!-- Div with input to delete user by userID -->
        <div class="row mt-3">
            <div class="col">
                <div class="input-group mb-3">
                   <p> Si vous voulez déconnecter votre Compte Facebook avec TsantaBot,  entrez l'ID Facebook de votre compte ici.</p>
                    
                    <input type="text" class="form-control" id="deleteUserID" placeholder="(Déconnecter?) Entrez  Facebook ID de votre Chatbot pour déconnecter ..">
                    <button class="btn btn-danger" onclick="deleteUser()">Oui, se Déconnecter</button>
                </div>
            </div>
        </div>
  </div>
</div>
      
      <style>
         .user-card {
         display: flex;
         align-items: center;
         margin-bottom: 10px;
         border: 1px solid #dee2e6;
         border-radius: 10px;
         padding: 5px;
         width: 100%;
         text-align: center;
         overflow: auto;
         animation: glow 2s infinite alternate; 
         }
         @keyframes glow {
         from {
         border-color: #000; 
         }
         to {
         border-color: #fff; 
         }
         }
         .user-card img {
         max-width: 100%;
         border-radius: 50%;
         margin-right: 10px;
         border: 2px solid blue;
         animation: glow2 2s infinite alternate; 
         }

         @keyframes glow2 {
         from {
         border-color: #000; 
         }
         to {
         border-color: blue; 
         }
         }
         .user-info {
         flex-grow: 1;
         }
         .user-info h4 {
         margin-left: 3px;
         margin-bottom: 3px;
         font-size: 16px;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
         text-align: start;
         }
         .user-info p {
         margin: 0;
         font-size: 12px;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
         text-align: start;
         }
         p {
         padding: 3px;
         }
         p.uptime-user {
         }
      </style>
      <script>
         async function listOfAi() {
             const userOnline = document.getElementById("user_online");
             try {
                 const response = await fetch("/info");
                 const data = await response.json();
                 userOnline.innerHTML = '';
                 data.forEach(user => {
                     const {
                         name,
                         thumbSrc,
                         profileUrl,
                         time,
                     } = user;
                     const userCard = document.createElement('div');
                     userCard.className = 'col-12 user-card mb-4';
                     const image = document.createElement('img');
                     image.src = thumbSrc;
                     image.alt = 'User Thumbnail';
                     image.className = 'img-thumbnail';
                     const userInfo = document.createElement('div');
                     userInfo.className = 'user-info';
                     const userName = document.createElement('h4');
                     userName.textContent = name;
                     const profileLink = document.createElement('p');
                     profileLink.innerHTML = `${profileUrl}`;
                     const uptimeUser = document.createElement('p');
                     uptimeUser.className = 'uptime-user';
                     uptimeUser.innerHTML = `Uptime: ${timeFormat(time)}`;
                     userInfo.appendChild(userName);
                     userInfo.appendChild(profileLink);
                     userInfo.appendChild(uptimeUser);
                     userCard.appendChild(image);
                     userCard.appendChild(userInfo);
                     userOnline.appendChild(userCard);
         
                     const intervalId = setInterval(() => {
                         user.time++;
                         updateTimer(userCard, user.time);
                     }, 1000);
                 });
             } catch (error) {
                 console.error(error);
                 userOnline.innerHTML = `<div class="alert alert-danger" role="alert">An error occurred while fetching data.</div>`;
             }
         }
         
         function updateTimer(userCard, currentTime) {
             const uptimeUser = userCard.querySelector('.uptime-user');
             uptimeUser.textContent = `Coeur: ${timeFormat(currentTime)}`;
         }
         
        function timeFormat(currentTime) {
            const days = Math.floor(currentTime / (3600 * 24));
            const hours = Math.floor((currentTime % (3600 * 24)) / 3600);
            const minutes = Math.floor((currentTime % 3600) / 60);
            const seconds = currentTime % 60;

            let timeFormat = '';

            switch (true) {
                case days > 0:
                    timeFormat += `${days} day${days > 1 ? 's' : ''} `;
                case hours > 0:
                    timeFormat += `${hours} hour${hours > 1 ? 's' : ''} `;
                case minutes > 0:
                    timeFormat += `${minutes} minute${minutes > 1 ? 's' : ''} `;
                default:
                    timeFormat += `${seconds} second${seconds > 1 ? 's' : ''}`;
            }

            return timeFormat.trim();
        }

         
         listOfAi();
         
      </script>
      <script>
        // Function to delete user
        async function deleteUser() {
            const deleteUserID = document.getElementById('deleteUserID').value;
            if (!deleteUserID) {
                alert('Entrez votre ID Facebook correcte.');
                return;
            }
            const response = await fetch(`/deleteUser/${deleteUserID}`, {
                method: 'DELETE'
            });
            if (response.ok) {
                alert('Votre Compte Facebook est déconnecté sur TsantaBot !');
                // You may want to refresh the user list after deletion, if needed.
                listOfAi();
            } else {
                alert('Failed to signout. Please try again.');
            }
        }

        // ... Existing script content ...
    </script>

      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
      
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
   </body>
</html>
